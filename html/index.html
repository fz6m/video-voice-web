<!DOCTYPE html>

<head>
  <style>
    .progress-c {
      width: 100%;
      height: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin: 20px 0px;
      overflow: hidden;
    }

    /* åˆå§‹çŠ¶æ€è®¾ç½®è¿›åº¦æ¡å®½åº¦ä¸º0px */
    .progress-c>div {
      width: 0px;
      height: 100%;
      background-color: yellowgreen;
      transition: all .3s ease;
    }

    .index {
      margin: 20px auto;
      width: 80%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .input-group {
      width: 80%;
    }

    #upload-file {
      display: none;
    }

    #multiple-column span {
      font-size: 0.5rem;
    }


  </style>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  <script>
    function select() { $('#upload-file').click() }

    function isNumber(value) {
      var patrn = /^\d+(\.\d+)?$/;
      if (patrn.exec(value) == null || value == "") {
        return false
      } else {
        return true
      }
    }

    function errorMessage(message, typesOf = 'error') {
      Swal.fire({
        icon: typesOf,
        // title: 'Oops...',
        text: message
      })
    }

    function uploadFile() {
      //è·å–ä¸Šä¼ çš„æ–‡ä»¶
      if (!$('#upload-file')[0].files[0]) {
        errorMessage('æ²¡æœ‰é€‰æ‹©æ–‡ä»¶')
        return
      }
      var uploadFile = $('#upload-file').get(0).files[0];
      if (uploadFile.type != 'video/mp4') {
        errorMessage('åªèƒ½ä¸Šä¼ è§†é¢‘')
        return
      }
      var formdata = new FormData();
      formdata.append('file', uploadFile);
      var multiple = $('#multiple').val()
      if (!multiple || !isNumber(multiple)) {
        errorMessage('å€æ•°å¡«å†™é”™è¯¯')
        return
      }
      formdata.append('multiple', multiple);
      $.ajax({
        url: '/uploadfileurl',
        type: 'post',
        dataType: 'json',
        processData: false,
        contentType: false,
        data: formdata,
        xhr: function () {
          var xhr = new XMLHttpRequest();
          //ä½¿ç”¨XMLHttpRequest.uploadç›‘å¬ä¸Šä¼ è¿‡ç¨‹ï¼Œæ³¨å†Œprogressäº‹ä»¶ï¼Œæ‰“å°å›è°ƒå‡½æ•°ä¸­çš„eventäº‹ä»¶
          xhr.upload.addEventListener('progress', function (e) {
            // loadedä»£è¡¨ä¸Šä¼ äº†å¤šå°‘
            // totalä»£è¡¨æ€»æ•°ä¸ºå¤šå°‘
            var progressRate = (e.loaded / e.total) * 100 + '%';
            //é€šè¿‡è®¾ç½®è¿›åº¦æ¡çš„å®½åº¦è¾¾åˆ°æ•ˆæœ
            $('.progress-c > div').css('width', progressRate);
            if (progressRate == '100%') {
              errorMessage('æ­£åœ¨è½¬æ¢ä¸­...è¯·ç­‰å¾…å‡ åˆ†é’Ÿ', 'info')
            }
          })
          return xhr;
        },
        success: function (res) {
          // console.log(res)
          if (!res.key || !res.url) {
            errorMessage('è·å–ä¸‹è½½é“¾æ¥å¤±è´¥ï¼Œè¯·é‡è¯•')
            return
          }
          errorMessage('è½¬æ¢æˆåŠŸï¼', 'success')
          $('#upload').attr('onclick', '')
          $('#upload').click(function () {
            window.location.href = res.url + res.key
          })
          $('#upload').removeClass('btn-primary')
          $('#upload').addClass('btn-success')
          $('#upload').text('ç‚¹å‡»ä¸‹è½½')
        }
      })
    }
  </script>

  <meta charset='utf-8'>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>å£°å‘å·¥å…·ğŸ“¢</title>


</head>

<body>
  <div class="container">
    <div class='index'>

      <h4 class="my-5">å£°å‘å·¥å…·ğŸ“¢</h4>

      <input type="file" id="upload-file">
      <button type="button" class="btn btn-primary" onclick="select()">é€‰æ‹©è§†é¢‘</button>

      <div class="progress-c my-5">
        <div></div>
      </div>

      <div id="multiple-column" class="input-group px-3 mb-3 rounded">
        <div class="input-group-prepend">
          <span class="input-group-text" id="basic-addon1">æ”¾å¤§å€æ•°(å¤ªå¤§ä¼šç ´éŸ³)</span>
        </div>
        <input type="text" id="multiple" class="form-control">
      </div>

      <button onclick="uploadFile()" type="button" class="btn btn-primary mt-5" id="upload">ä¸Šä¼ è§†é¢‘</button>
    </div>
  </div>
</body>